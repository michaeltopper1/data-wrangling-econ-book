<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 10 An Introduction to Web Scraping in R | Data Wrangling for Economists</title>
  <meta name="description" content="Enter description." />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 10 An Introduction to Web Scraping in R | Data Wrangling for Economists" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Enter description." />
  <meta name="github-repo" content="openscapes/series" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 10 An Introduction to Web Scraping in R | Data Wrangling for Economists" />
  
  <meta name="twitter:description" content="Enter description." />
  

<meta name="author" content="Michael Topper" />
<meta name="author" content="Danny Klinenberg" />


<meta name="date" content="2021-09-10" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="strings.html"/>
<link rel="next" href="programming.html"/>
<script src="libs/header-attrs-2.10/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/str_view-0.1.0/str_view.css" rel="stylesheet" />
<script src="libs/str_view-binding-1.4.0/str_view.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="lib/css/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" href="lib/css/style.css" type="text/css" />
<link rel="stylesheet" href="lib/css/lesson.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Data Wrangling for Economists</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Welcome</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#organization"><i class="fa fa-check"></i><b>1.1</b> Organization</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="intro-to-r.html"><a href="intro-to-r.html"><i class="fa fa-check"></i><b>2</b> Intro to R</a>
<ul>
<li class="chapter" data-level="2.1" data-path="intro-to-r.html"><a href="intro-to-r.html#basic-summary-statistics"><i class="fa fa-check"></i><b>2.1</b> Basic summary statistics</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="intro-to-r.html"><a href="intro-to-r.html#exercise"><i class="fa fa-check"></i><b>2.1.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="intro-to-r.html"><a href="intro-to-r.html#basic-histogram"><i class="fa fa-check"></i><b>2.2</b> Basic histogram</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="intro-to-r.html"><a href="intro-to-r.html#exercise-1"><i class="fa fa-check"></i><b>2.2.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="intro-to-r.html"><a href="intro-to-r.html#creating-vectors"><i class="fa fa-check"></i><b>2.3</b> Creating Vectors</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="intro-to-r.html"><a href="intro-to-r.html#exercise-2"><i class="fa fa-check"></i><b>2.3.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="intro-to-r.html"><a href="intro-to-r.html#comparing-vectors"><i class="fa fa-check"></i><b>2.4</b> Comparing Vectors</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="intro-to-r.html"><a href="intro-to-r.html#exercise-3"><i class="fa fa-check"></i><b>2.4.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="intro-to-r.html"><a href="intro-to-r.html#creating-a-tibble"><i class="fa fa-check"></i><b>2.5</b> Creating a tibble</a></li>
<li class="chapter" data-level="2.6" data-path="intro-to-r.html"><a href="intro-to-r.html#exercise-4"><i class="fa fa-check"></i><b>2.6</b> Exercise</a></li>
<li class="chapter" data-level="2.7" data-path="intro-to-r.html"><a href="intro-to-r.html#selected-solutions"><i class="fa fa-check"></i><b>2.7</b> Selected Solutions</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="the-rproject.html"><a href="the-rproject.html"><i class="fa fa-check"></i><b>3</b> The <code>Rproject</code></a></li>
<li class="chapter" data-level="4" data-path="git-and-github.html"><a href="git-and-github.html"><i class="fa fa-check"></i><b>4</b> Git and Github</a>
<ul>
<li class="chapter" data-level="4.1" data-path="git-and-github.html"><a href="git-and-github.html#installing-git"><i class="fa fa-check"></i><b>4.1</b> Installing Git</a></li>
<li class="chapter" data-level="4.2" data-path="git-and-github.html"><a href="git-and-github.html#create-a-github-account"><i class="fa fa-check"></i><b>4.2</b> Create a Github account</a></li>
<li class="chapter" data-level="4.3" data-path="git-and-github.html"><a href="git-and-github.html#introduce-yourself-to-git"><i class="fa fa-check"></i><b>4.3</b> Introduce yourself to Git</a></li>
<li class="chapter" data-level="4.4" data-path="git-and-github.html"><a href="git-and-github.html#create-a-pat"><i class="fa fa-check"></i><b>4.4</b> Create a PAT</a></li>
<li class="chapter" data-level="4.5" data-path="git-and-github.html"><a href="git-and-github.html#the-workflow"><i class="fa fa-check"></i><b>4.5</b> The Workflow</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="git-and-github.html"><a href="git-and-github.html#definitions"><i class="fa fa-check"></i><b>4.5.1</b> Definitions</a></li>
<li class="chapter" data-level="4.5.2" data-path="git-and-github.html"><a href="git-and-github.html#the-workflow-1"><i class="fa fa-check"></i><b>4.5.2</b> The Workflow</a></li>
<li class="chapter" data-level="4.5.3" data-path="git-and-github.html"><a href="git-and-github.html#the-git-panel-of-rstudio"><i class="fa fa-check"></i><b>4.5.3</b> The Git panel of RStudio</a></li>
<li class="chapter" data-level="4.5.4" data-path="git-and-github.html"><a href="git-and-github.html#pulling"><i class="fa fa-check"></i><b>4.5.4</b> Pulling</a></li>
<li class="chapter" data-level="4.5.5" data-path="git-and-github.html"><a href="git-and-github.html#commiting"><i class="fa fa-check"></i><b>4.5.5</b> Commiting</a></li>
<li class="chapter" data-level="4.5.6" data-path="git-and-github.html"><a href="git-and-github.html#pushing"><i class="fa fa-check"></i><b>4.5.6</b> Pushing</a></li>
<li class="chapter" data-level="4.5.7" data-path="git-and-github.html"><a href="git-and-github.html#pulling-again"><i class="fa fa-check"></i><b>4.5.7</b> Pulling (again)</a></li>
<li class="chapter" data-level="4.5.8" data-path="git-and-github.html"><a href="git-and-github.html#the-main-commands-command-lineterminal"><i class="fa fa-check"></i><b>4.5.8</b> The Main Commands (Command Line/Terminal)</a></li>
<li class="chapter" data-level="4.5.9" data-path="git-and-github.html"><a href="git-and-github.html#exercise-5"><i class="fa fa-check"></i><b>4.5.9</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="git-and-github.html"><a href="git-and-github.html#branches"><i class="fa fa-check"></i><b>4.6</b> Branches</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="git-and-github.html"><a href="git-and-github.html#creating-a-branch"><i class="fa fa-check"></i><b>4.6.1</b> Creating a branch</a></li>
<li class="chapter" data-level="4.6.2" data-path="git-and-github.html"><a href="git-and-github.html#branches-when-working-independently"><i class="fa fa-check"></i><b>4.6.2</b> Branches when working independently</a></li>
<li class="chapter" data-level="4.6.3" data-path="git-and-github.html"><a href="git-and-github.html#branches-when-working-collaboratively"><i class="fa fa-check"></i><b>4.6.3</b> Branches when working collaboratively</a></li>
<li class="chapter" data-level="4.6.4" data-path="git-and-github.html"><a href="git-and-github.html#branches-with-the-terminal"><i class="fa fa-check"></i><b>4.6.4</b> Branches with the Terminal</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="git-and-github.html"><a href="git-and-github.html#gitignore"><i class="fa fa-check"></i><b>4.7</b> .gitignore</a></li>
<li class="chapter" data-level="4.8" data-path="git-and-github.html"><a href="git-and-github.html#reverting"><i class="fa fa-check"></i><b>4.8</b> Reverting</a>
<ul>
<li class="chapter" data-level="4.8.1" data-path="git-and-github.html"><a href="git-and-github.html#reverting-safelty"><i class="fa fa-check"></i><b>4.8.1</b> Reverting Safelty</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="cleaning-data-i.html"><a href="cleaning-data-i.html"><i class="fa fa-check"></i><b>5</b> Cleaning Data I</a>
<ul>
<li class="chapter" data-level="5.1" data-path="cleaning-data-i.html"><a href="cleaning-data-i.html#the-pipe"><i class="fa fa-check"></i><b>5.1</b> The Pipe</a></li>
<li class="chapter" data-level="5.2" data-path="cleaning-data-i.html"><a href="cleaning-data-i.html#the-clean_names-function"><i class="fa fa-check"></i><b>5.2</b> The <code>clean_names</code> function</a></li>
<li class="chapter" data-level="5.3" data-path="cleaning-data-i.html"><a href="cleaning-data-i.html#the-select-function"><i class="fa fa-check"></i><b>5.3</b> The <code>select</code> function</a></li>
<li class="chapter" data-level="5.4" data-path="cleaning-data-i.html"><a href="cleaning-data-i.html#the-filter-function"><i class="fa fa-check"></i><b>5.4</b> The <code>filter</code> function</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="cleaning-data-i.html"><a href="cleaning-data-i.html#exercise-6"><i class="fa fa-check"></i><b>5.4.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="cleaning-data-i.html"><a href="cleaning-data-i.html#the-distinct-function"><i class="fa fa-check"></i><b>5.5</b> The <code>distinct</code> function</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="cleaning-data-i.html"><a href="cleaning-data-i.html#exercise-7"><i class="fa fa-check"></i><b>5.5.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="cleaning-data-i.html"><a href="cleaning-data-i.html#the-mutate-function."><i class="fa fa-check"></i><b>5.6</b> The <code>mutate</code> function.</a></li>
<li class="chapter" data-level="5.7" data-path="cleaning-data-i.html"><a href="cleaning-data-i.html#the-summarize-function"><i class="fa fa-check"></i><b>5.7</b> The <code>summarize</code> function</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="cleaning-data-i.html"><a href="cleaning-data-i.html#exercise-8"><i class="fa fa-check"></i><b>5.7.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="cleaning-data-i.html"><a href="cleaning-data-i.html#the-group_by-and-summarize-functions"><i class="fa fa-check"></i><b>5.8</b> The <code>group_by</code> and <code>summarize</code> functions</a></li>
<li class="chapter" data-level="5.9" data-path="cleaning-data-i.html"><a href="cleaning-data-i.html#exercise-9"><i class="fa fa-check"></i><b>5.9</b> Exercise</a>
<ul>
<li class="chapter" data-level="5.9.1" data-path="cleaning-data-i.html"><a href="cleaning-data-i.html#exercise-10"><i class="fa fa-check"></i><b>5.9.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="5.10" data-path="cleaning-data-i.html"><a href="cleaning-data-i.html#selected-solutions-1"><i class="fa fa-check"></i><b>5.10</b> Selected Solutions</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="data-cleaning-ii.html"><a href="data-cleaning-ii.html"><i class="fa fa-check"></i><b>6</b> Data Cleaning II</a>
<ul>
<li class="chapter" data-level="6.1" data-path="data-cleaning-ii.html"><a href="data-cleaning-ii.html#the-count-function"><i class="fa fa-check"></i><b>6.1</b> The <code>count</code> function</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="data-cleaning-ii.html"><a href="data-cleaning-ii.html#exercise-11"><i class="fa fa-check"></i><b>6.1.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="data-cleaning-ii.html"><a href="data-cleaning-ii.html#using-the-is.na-function"><i class="fa fa-check"></i><b>6.2</b> Using the <code>is.na</code> function</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="data-cleaning-ii.html"><a href="data-cleaning-ii.html#exercise-12"><i class="fa fa-check"></i><b>6.2.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="data-cleaning-ii.html"><a href="data-cleaning-ii.html#the-arrange-function"><i class="fa fa-check"></i><b>6.3</b> The <code>arrange</code> function</a></li>
<li class="chapter" data-level="6.4" data-path="data-cleaning-ii.html"><a href="data-cleaning-ii.html#the-filter-function-with-logicals"><i class="fa fa-check"></i><b>6.4</b> The <code>filter</code> function with logicals</a></li>
<li class="chapter" data-level="6.5" data-path="data-cleaning-ii.html"><a href="data-cleaning-ii.html#exercise-13"><i class="fa fa-check"></i><b>6.5</b> Exercise</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="data-cleaning-ii.html"><a href="data-cleaning-ii.html#exercise-14"><i class="fa fa-check"></i><b>6.5.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="data-cleaning-ii.html"><a href="data-cleaning-ii.html#selected-solutions-2"><i class="fa fa-check"></i><b>6.6</b> Selected Solutions</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="graphics-with-ggplot2.html"><a href="graphics-with-ggplot2.html"><i class="fa fa-check"></i><b>7</b> Graphics with ggplot2</a>
<ul>
<li class="chapter" data-level="7.1" data-path="graphics-with-ggplot2.html"><a href="graphics-with-ggplot2.html#the-grammar-of-graphics"><i class="fa fa-check"></i><b>7.1</b> The grammar of graphics</a></li>
<li class="chapter" data-level="7.2" data-path="graphics-with-ggplot2.html"><a href="graphics-with-ggplot2.html#adding-options"><i class="fa fa-check"></i><b>7.2</b> Adding options</a></li>
<li class="chapter" data-level="7.3" data-path="graphics-with-ggplot2.html"><a href="graphics-with-ggplot2.html#adding-multiple-plots-together"><i class="fa fa-check"></i><b>7.3</b> Adding multiple plots together</a></li>
<li class="chapter" data-level="7.4" data-path="graphics-with-ggplot2.html"><a href="graphics-with-ggplot2.html#creating-legends"><i class="fa fa-check"></i><b>7.4</b> Creating legends</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="graphics-with-ggplot2.html"><a href="graphics-with-ggplot2.html#exercise-15"><i class="fa fa-check"></i><b>7.4.1</b> Exercise</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="file-organization.html"><a href="file-organization.html"><i class="fa fa-check"></i><b>8</b> File Organization</a>
<ul>
<li class="chapter" data-level="8.1" data-path="file-organization.html"><a href="file-organization.html#organizing"><i class="fa fa-check"></i><b>8.1</b> Organizing</a></li>
<li class="chapter" data-level="8.2" data-path="file-organization.html"><a href="file-organization.html#rmarkdown"><i class="fa fa-check"></i><b>8.2</b> <code>Rmarkdown</code></a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="file-organization.html"><a href="file-organization.html#the-anatomy-of-an-rmarkdown-file"><i class="fa fa-check"></i><b>8.2.1</b> The Anatomy of an <code>Rmarkdown</code> File</a></li>
<li class="chapter" data-level="8.2.2" data-path="file-organization.html"><a href="file-organization.html#the-body-of-the-rmarkdown"><i class="fa fa-check"></i><b>8.2.2</b> The Body of the <code>Rmarkdown</code></a></li>
<li class="chapter" data-level="8.2.3" data-path="file-organization.html"><a href="file-organization.html#childing"><i class="fa fa-check"></i><b>8.2.3</b> Childing</a></li>
<li class="chapter" data-level="8.2.4" data-path="file-organization.html"><a href="file-organization.html#bibliographies"><i class="fa fa-check"></i><b>8.2.4</b> Bibliographies</a></li>
<li class="chapter" data-level="8.2.5" data-path="file-organization.html"><a href="file-organization.html#a-final-note-on-rmarkdown-visual-markdown-editor"><i class="fa fa-check"></i><b>8.2.5</b> A Final Note on <code>Rmarkdown</code>: Visual Markdown Editor</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="strings.html"><a href="strings.html"><i class="fa fa-check"></i><b>9</b> Strings</a>
<ul>
<li class="chapter" data-level="9.1" data-path="strings.html"><a href="strings.html#regular-expressions"><i class="fa fa-check"></i><b>9.1</b> Regular Expressions</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="strings.html"><a href="strings.html#exercise-1-1"><i class="fa fa-check"></i><b>9.1.1</b> Exercise 1</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="strings.html"><a href="strings.html#regular-expressions-continued"><i class="fa fa-check"></i><b>9.2</b> Regular Expressions Continued</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="strings.html"><a href="strings.html#exercise-2-1"><i class="fa fa-check"></i><b>9.2.1</b> Exercise 2</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="strings.html"><a href="strings.html#using-extract"><i class="fa fa-check"></i><b>9.3</b> Using <code>extract</code></a></li>
<li class="chapter" data-level="9.4" data-path="strings.html"><a href="strings.html#using-separate"><i class="fa fa-check"></i><b>9.4</b> Using <code>separate</code></a></li>
<li class="chapter" data-level="9.5" data-path="strings.html"><a href="strings.html#the-gsub-function"><i class="fa fa-check"></i><b>9.5</b> The <code>gsub</code> function</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="strings.html"><a href="strings.html#exercise-3-1"><i class="fa fa-check"></i><b>9.5.1</b> Exercise 3</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="strings.html"><a href="strings.html#solutions"><i class="fa fa-check"></i><b>9.6</b> Solutions</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="an-introduction-to-web-scraping-in-r.html"><a href="an-introduction-to-web-scraping-in-r.html"><i class="fa fa-check"></i><b>10</b> An Introduction to Web Scraping in R</a>
<ul>
<li class="chapter" data-level="10.1" data-path="an-introduction-to-web-scraping-in-r.html"><a href="an-introduction-to-web-scraping-in-r.html#what-is-web-scraping"><i class="fa fa-check"></i><b>10.1</b> What is Web Scraping?</a></li>
<li class="chapter" data-level="10.2" data-path="an-introduction-to-web-scraping-in-r.html"><a href="an-introduction-to-web-scraping-in-r.html#can-i-scrape-from-this-site"><i class="fa fa-check"></i><b>10.2</b> Can I Scrape From This Site?</a></li>
<li class="chapter" data-level="10.3" data-path="an-introduction-to-web-scraping-in-r.html"><a href="an-introduction-to-web-scraping-in-r.html#pulling-from-an-api-hechingers-report"><i class="fa fa-check"></i><b>10.3</b> Pulling from an API: Hechinger’s Report</a></li>
<li class="chapter" data-level="10.4" data-path="an-introduction-to-web-scraping-in-r.html"><a href="an-introduction-to-web-scraping-in-r.html#web-scraping-ucsb-economics-contact-information"><i class="fa fa-check"></i><b>10.4</b> Web Scraping: UCSB Economics Contact Information</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="programming.html"><a href="programming.html"><i class="fa fa-check"></i><b>11</b> Programming</a>
<ul>
<li class="chapter" data-level="11.1" data-path="programming.html"><a href="programming.html#functions"><i class="fa fa-check"></i><b>11.1</b> Functions</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="programming.html"><a href="programming.html#exercise-16"><i class="fa fa-check"></i><b>11.1.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="programming.html"><a href="programming.html#for-loops"><i class="fa fa-check"></i><b>11.2</b> For-loops</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="programming.html"><a href="programming.html#exercise-17"><i class="fa fa-check"></i><b>11.2.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="programming.html"><a href="programming.html#if-else"><i class="fa fa-check"></i><b>11.3</b> If-else</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="programming.html"><a href="programming.html#exercise-18"><i class="fa fa-check"></i><b>11.3.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="programming.html"><a href="programming.html#selected-solutions-3"><i class="fa fa-check"></i><b>11.4</b> Selected Solutions</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="relational-data.html"><a href="relational-data.html"><i class="fa fa-check"></i><b>12</b> Relational Data</a>
<ul>
<li class="chapter" data-level="12.1" data-path="relational-data.html"><a href="relational-data.html#finding-primary-keys"><i class="fa fa-check"></i><b>12.1</b> Finding Primary Keys</a></li>
<li class="chapter" data-level="12.2" data-path="relational-data.html"><a href="relational-data.html#finding-primary-keys-harder"><i class="fa fa-check"></i><b>12.2</b> Finding Primary Keys (harder)</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="relational-data.html"><a href="relational-data.html#exercise-19"><i class="fa fa-check"></i><b>12.2.1</b> Exercise</a></li>
<li class="chapter" data-level="12.2.2" data-path="relational-data.html"><a href="relational-data.html#exercise-20"><i class="fa fa-check"></i><b>12.2.2</b> Exercise</a></li>
<li class="chapter" data-level="12.2.3" data-path="relational-data.html"><a href="relational-data.html#exercise-21"><i class="fa fa-check"></i><b>12.2.3</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="relational-data.html"><a href="relational-data.html#selected-solutions-4"><i class="fa fa-check"></i><b>12.3</b> Selected Solutions</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Wrangling for Economists</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="an-introduction-to-web-scraping-in-r" class="section level1" number="10">
<h1><span class="header-section-number">Chapter 10</span> An Introduction to Web Scraping in R</h1>
<blockquote>
<p><em>Note: This document is meant for internal uses within UCSB. Proper citations have not been included in this draft. Please use this document as an individual learning tool, not for official citation or distribution.</em></p>
</blockquote>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="an-introduction-to-web-scraping-in-r.html#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Packages for lesson:</span></span>
<span id="cb207-2"><a href="an-introduction-to-web-scraping-in-r.html#cb207-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pacman)</span>
<span id="cb207-3"><a href="an-introduction-to-web-scraping-in-r.html#cb207-3" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(</span>
<span id="cb207-4"><a href="an-introduction-to-web-scraping-in-r.html#cb207-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;jsonlite&quot;</span>,<span class="co"># read in json formats</span></span>
<span id="cb207-5"><a href="an-introduction-to-web-scraping-in-r.html#cb207-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;formatR&quot;</span>, <span class="co"># makes code wrap in an Rmarkdown file</span></span>
<span id="cb207-6"><a href="an-introduction-to-web-scraping-in-r.html#cb207-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;glue&quot;</span>, <span class="co"># tidyverse concatenate text</span></span>
<span id="cb207-7"><a href="an-introduction-to-web-scraping-in-r.html#cb207-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;magrittr&quot;</span>,<span class="co"># fancy pipe</span></span>
<span id="cb207-8"><a href="an-introduction-to-web-scraping-in-r.html#cb207-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;polite&quot;</span>,<span class="co"># make sure website is okay to scrape</span></span>
<span id="cb207-9"><a href="an-introduction-to-web-scraping-in-r.html#cb207-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;rvest&quot;</span>,<span class="co"># Grabbing, formatting, and cleaning html code</span></span>
<span id="cb207-10"><a href="an-introduction-to-web-scraping-in-r.html#cb207-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;tidyverse&quot;</span><span class="co"># Thanks Hadley Wickham!</span></span>
<span id="cb207-11"><a href="an-introduction-to-web-scraping-in-r.html#cb207-11" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>In addition, this lesson will require using Google Chrome and the <a href="https://selectorgadget.com/">selector gadget</a> extension. This <a href="https://chrome.google.com/webstore/detail/selectorgadget/mhjhnkcfbdhnjickkkdbjoemdmbfginb?hl=en">link</a> is to Google Chrome selector gadget extension. Please add the selector gadget to Google Chrome now.</p>
<div id="what-is-web-scraping" class="section level2" number="10.1">
<h2><span class="header-section-number">10.1</span> What is Web Scraping?</h2>
<p>Web scraping is a general term that tends to relate to pulling data from some web pages and converting it into a usable, or tidy, form. Colloquially, we tend to refer to two different methods when we say “web scraping.”</p>
<p>The first is actually <strong>API pulling</strong>. This is accessing a website’s underlying data organization and directly using that. In this case, the data is in a clean and usable form - we just have to pull it in. The second is actual <strong>web scraping</strong>. This process involves pulling html code from a website, cleaning and ultimately creating a tidy dataset. If given the choice, always API pull. API pulling is easier, there is less chance for user error, and ultimately faster.</p>
<p>In this lesson, we’ll go through an example of pulling from an API and web scraping. We’ll be pulling from the <a href="https://tuitiontracker.org/fitness/school.html?unitid=110705">Hechinger Report of UC - Santa Barbara</a> as an example of an API pull and scraping the <a href="%22https://econ.ucsb.edu/people%22">UCSB Economics directory</a>. For the purposes of this lesson, we’ll use the term <em>scrape</em> to describe both pulling and scraping from a website (as is colloquial).</p>
</div>
<div id="can-i-scrape-from-this-site" class="section level2" number="10.2">
<h2><span class="header-section-number">10.2</span> Can I Scrape From This Site?</h2>
<p>Before scraping a website, we must ensure the site is scrape-able. This means that the owners of the site are okay with individuals taking information from their site. Reasons they may not be okay with this is proprietary information or crashing the site. Constantly accessing sites with a scraper, or code meant to extract data from a website, can lead to performance issues and ultimately crashing a site. To see if we’re allowed to scrape from a site, we’ll use the package <code>polite</code>. There is a useful repository <a href="https://github.com/dmi3kno/polite">here</a>.</p>
<p><code>polite</code> ’s main function is <code>bow</code>.<a href="#fn12" class="footnote-ref" id="fnref12"><sup>12</sup></a> This command is politely asking if we have permission to access a website. The general framework of the command is as follows:</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="an-introduction-to-web-scraping-in-r.html#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bow</span>(</span>
<span id="cb208-2"><a href="an-introduction-to-web-scraping-in-r.html#cb208-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">url =</span> <span class="st">&quot;https://tuitiontracker.org/fitness/data/school-data/&quot;</span>,</span>
<span id="cb208-3"><a href="an-introduction-to-web-scraping-in-r.html#cb208-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb208-4"><a href="an-introduction-to-web-scraping-in-r.html#cb208-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">user_agent =</span> <span class="st">&quot;Danny Klinenberg &lt;dklinenberg@ucsb.edu&gt;&quot;</span></span>
<span id="cb208-5"><a href="an-introduction-to-web-scraping-in-r.html#cb208-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>The command <code>url</code> is our target site we wish to scrape. <code>user_agent</code> is our name and email. While the <code>user_agent</code> is not necessary, it’s extra polite to the hosts of the website.</p>
<p>If we’re allowed to scrape from a website, the result will look like this:</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="an-introduction-to-web-scraping-in-r.html#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bow</span>(</span>
<span id="cb209-2"><a href="an-introduction-to-web-scraping-in-r.html#cb209-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">url =</span> <span class="st">&quot;https://tuitiontracker.org/fitness/data/school-data/&quot;</span>,</span>
<span id="cb209-3"><a href="an-introduction-to-web-scraping-in-r.html#cb209-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb209-4"><a href="an-introduction-to-web-scraping-in-r.html#cb209-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">user_agent =</span> <span class="st">&quot;Danny Klinenberg &lt;dklinenberg@ucsb.edu&gt;&quot;</span></span>
<span id="cb209-5"><a href="an-introduction-to-web-scraping-in-r.html#cb209-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## &lt;polite session&gt; https://tuitiontracker.org/fitness/data/school-data/
##     User-agent: Danny Klinenberg &lt;dklinenberg@ucsb.edu&gt;
##     robots.txt: 1 rules are defined for 1 bots
##    Crawl delay: 5 sec
##   The path is scrapable for this user-agent</code></pre>
<p>Let’s walk through the lines of output. Line one is the website we’re asking to pull from. Line 2 is us identifying ourselves. Line 3 are the rules of pulling from their website.<a href="#fn13" class="footnote-ref" id="fnref13"><sup>13</sup></a> Line 4 is the crawl delay. This is how much time the hosts requests between pulling from the website. Hosts asks for crawl delays to avoid overloading the site leading to a crash. If we are to pull alot of time from a website, we may get blocked for not following this rule. We’ll talk about how to add time between pulls in the UCSB Economics example.<a href="#fn14" class="footnote-ref" id="fnref14"><sup>14</sup></a></p>
<p>If we are not allowed to scrape, the results will look like this:</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="an-introduction-to-web-scraping-in-r.html#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bow</span>(</span>
<span id="cb211-2"><a href="an-introduction-to-web-scraping-in-r.html#cb211-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">url =</span> <span class="st">&quot;https://collegecrisis.shinyapps.io/dashboard/&quot;</span>,</span>
<span id="cb211-3"><a href="an-introduction-to-web-scraping-in-r.html#cb211-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb211-4"><a href="an-introduction-to-web-scraping-in-r.html#cb211-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">user_agent =</span> <span class="st">&quot;Danny Klinenberg &lt;dklinenberg@ucsb.edu&gt;&quot;</span></span>
<span id="cb211-5"><a href="an-introduction-to-web-scraping-in-r.html#cb211-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## &lt;polite session&gt; https://collegecrisis.shinyapps.io/dashboard/
##     User-agent: Danny Klinenberg &lt;dklinenberg@ucsb.edu&gt;
##     robots.txt: 1 rules are defined for 1 bots
##    Crawl delay: 5 sec
##   The path is not scrapable for this user-agent</code></pre>
<p>The legal, ethical, and moral issues of scraping web pages are a popular topic right now. For example, are we really not allowed to scrape a site that asks us not to scrape? Can the authors really do anything to us? If we find ourselves in need of information on a site we’re not given permission to scrape, the best next step is to contact the authors of the site. It’s safest and you don’t want to find yourself in a legal battle over some data. It’s (probably) not worth it?</p>
</div>
<div id="pulling-from-an-api-hechingers-report" class="section level2" number="10.3">
<h2><span class="header-section-number">10.3</span> Pulling from an API: Hechinger’s Report</h2>
<p>The Hechinger’s Report created a college financial fitness report for most universities based off of the book <a href="https://jhupbooks.press.jhu.edu/title/college-stress-test"><em>College Stress Test</em></a><em>.</em> The report shows the financial health of a school along four metrics: enrollment, retention, average tuition, and appropriations. Let’s take a look at how UCSB did. The url for UCSB’s financial health report is <a href="https://tuitiontracker.org/fitness/school.html?unitid=110705" class="uri">https://tuitiontracker.org/fitness/school.html?unitid=110705</a>. The page looks like this (I added the green circle):</p>
<div class="figure">
<img src="web_scraping_tutorial/pictures/p1.png" alt="" />
<p class="caption">UCSB Report</p>
</div>
<p>We’re interested in getting the scores for the four stress variables. Bars filled in with red signify levels of stress. More red bars means more stress. In UCSB’s case, they have no stress (yay!). However, this isn’t in a format to pull directly into a tibble. Analysis is not possible…yet.</p>
<p>If we’re using Google chrome, we can dive into the website source code by right clicking on the page and choosing <code>inspect</code>:</p>
<div class="figure">
<img src="web_scraping_tutorial/pictures/p2.png" style="width:100.0%" alt="" />
<p class="caption">Opening Inspector</p>
</div>
<p>After opening inspector, we immediately see half our screen is engulfed with funky code. This is html code, the bones of the website:</p>
<div class="figure">
<img src="web_scraping_tutorial/pictures/p3.png" style="width:100.0%" alt="" />
<p class="caption">HTML Code</p>
</div>
<p>As a fun tangent, to see which part of the webpage corresponds to which part of the html code we can press <code>cmnd+shft+c</code> on a Mac. To exit out of this mode, we can press <code>esc</code>.</p>
<p>Most of the time, websites pull data from their own API. To see if this is the case here, we can go to the <em>network</em> tab:</p>
<div class="figure">
<img src="web_scraping_tutorial/pictures/p4.png" style="width:100.0%" alt="" />
<p class="caption">Press the Network tab: Green Arrow</p>
</div>
<p>Now that we have the network tab open, the key is to refresh the page. That way, we’ll be able to see all the files this web page pulls in. And with a bit of luck, we’ll find the file that houses all the data we need.</p>
<div class="figure">
<img src="web_scraping_tutorial/pictures/p5.png" style="width:100.0%" alt="" />
<p class="caption">Network Tab After Refreshing the Page</p>
</div>
<p>Most of these files are well beyond my understanding of website infrastructure. However, I have figured out that sites tend to store their underlying data as a <code>.csv</code> , <code>.json</code> or <code>.ndjson</code> . A <code>.json</code> is a more flexible <code>.csv</code>. Think of a <code>.json</code> as a <code>.csv</code> only instead of each cell housing a single data, it can house another <code>.csv</code>. In <code>R</code> terms, a <code>.json</code> is like a list. A <code>.ndjson</code> is like a <code>.json</code> only each row is it’s very own <code>.json</code>.<a href="#fn15" class="footnote-ref" id="fnref15"><sup>15</sup></a> Once we find a .<code>json</code>, we can right click it and copy the file path. Here, I’m opening <strong>110705.json</strong>:</p>
<div class="figure">
<img src="web_scraping_tutorial/pictures/p6.png" style="width:100.0%" alt="" />
<p class="caption">Opening .json Attempt 1</p>
</div>
<p>Once we copy the link address, we can paste it in a new tab in Chrome and see where it takes us:</p>
<div class="figure">
<img src="web_scraping_tutorial/pictures/p7.png" style="width:100.0%" alt="" />
<p class="caption">Opening the .json Link</p>
</div>
<p>We grabbed the right one. Nice! We can then import the file directly into <code>R</code>:</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="an-introduction-to-web-scraping-in-r.html#cb213-1" aria-hidden="true" tabindex="-1"></a>ucsb <span class="ot">&lt;-</span> jsonlite<span class="sc">::</span><span class="fu">read_json</span>(<span class="st">&quot;https://tuitiontracker.org/fitness/data/school-data/110705.json&quot;</span>)</span></code></pre></div>
<p>We can then grab things like the name, IPEDS UNITID, and the stress scores (stored in flags):</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="an-introduction-to-web-scraping-in-r.html#cb214-1" aria-hidden="true" tabindex="-1"></a>ucsb<span class="sc">$</span>institution</span></code></pre></div>
<pre><code>## [1] &quot;University of California-Santa Barbara&quot;</code></pre>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="an-introduction-to-web-scraping-in-r.html#cb216-1" aria-hidden="true" tabindex="-1"></a>ucsb<span class="sc">$</span>unitid</span></code></pre></div>
<pre><code>## [1] &quot;110705&quot;</code></pre>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="an-introduction-to-web-scraping-in-r.html#cb218-1" aria-hidden="true" tabindex="-1"></a>ucsb<span class="sc">$</span>flags</span></code></pre></div>
<pre><code>## [1] &quot;[0,0,0,0]&quot;</code></pre>
<p>Now, having data on one school is cool, but what if we had data on all the schools. For example, suppose we were interested in finding the stress scores for the following schools:</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="an-introduction-to-web-scraping-in-r.html#cb220-1" aria-hidden="true" tabindex="-1"></a>schools <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">schools =</span> <span class="fu">c</span>(<span class="st">&quot;UCSB&quot;</span>, <span class="st">&quot;Cal Poly SLO&quot;</span>, <span class="st">&quot;Sac State&quot;</span>),</span>
<span id="cb220-2"><a href="an-introduction-to-web-scraping-in-r.html#cb220-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">unitid =</span> <span class="fu">c</span>(<span class="dv">110705</span>, <span class="dv">110422</span>, <span class="dv">110617</span>))</span>
<span id="cb220-3"><a href="an-introduction-to-web-scraping-in-r.html#cb220-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(schools)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 2
##   schools      unitid
##   &lt;chr&gt;         &lt;dbl&gt;
## 1 UCSB         110705
## 2 Cal Poly SLO 110422
## 3 Sac State    110617</code></pre>
<p>Let’s look at the url for UCSB: "<a href="https://tuitiontracker.org/fitness/data/school-data/110705.json%22" class="uri">https://tuitiontracker.org/fitness/data/school-data/110705.json%22</a>.</p>
<p>Now, let’s look at the url for Sac State: "<a href="https://tuitiontracker.org/fitness/data/school-data/110705.json%22">https://tuitiontracker.org/fitness/data/school-data/110617.json"</a></p>
<p>Notice that the urls are identical except of the numbers before .json. Usually, websites have some sort of method for their url names. In this case, the data url is “<a href="https://tuitiontracker.org/fitness/data/school-data/" class="uri">https://tuitiontracker.org/fitness/data/school-data/</a><strong>UNITID</strong>.json,” where UNITID is the IPEDS UNITID. We can pull those off of IPEDS easy, so all we’d need to do to get the stress scores is loop through the UNITIDS! Let’s do that here:</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="an-introduction-to-web-scraping-in-r.html#cb222-1" aria-hidden="true" tabindex="-1"></a>num_schools <span class="ot">&lt;-</span> <span class="dv">3</span>  <span class="co"># interested in 3 schools</span></span>
<span id="cb222-2"><a href="an-introduction-to-web-scraping-in-r.html#cb222-2" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">school =</span> <span class="fu">rep</span>(<span class="cn">NA</span>, num_schools), <span class="at">unitid =</span> <span class="fu">rep</span>(<span class="cn">NA</span>,</span>
<span id="cb222-3"><a href="an-introduction-to-web-scraping-in-r.html#cb222-3" aria-hidden="true" tabindex="-1"></a>    num_schools), <span class="at">enrollment_stress =</span> <span class="fu">rep</span>(<span class="cn">NA</span>, num_schools),</span>
<span id="cb222-4"><a href="an-introduction-to-web-scraping-in-r.html#cb222-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">retention_stress =</span> <span class="fu">rep</span>(<span class="cn">NA</span>, num_schools), <span class="at">avg_tui_stress =</span> <span class="fu">rep</span>(<span class="cn">NA</span>,</span>
<span id="cb222-5"><a href="an-introduction-to-web-scraping-in-r.html#cb222-5" aria-hidden="true" tabindex="-1"></a>        num_schools), <span class="at">approp_stress =</span> <span class="fu">rep</span>(<span class="cn">NA</span>, num_schools))</span>
<span id="cb222-6"><a href="an-introduction-to-web-scraping-in-r.html#cb222-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-7"><a href="an-introduction-to-web-scraping-in-r.html#cb222-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_schools) {</span>
<span id="cb222-8"><a href="an-introduction-to-web-scraping-in-r.html#cb222-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># remember, we&#39;re polite, so we honor the 5 second</span></span>
<span id="cb222-9"><a href="an-introduction-to-web-scraping-in-r.html#cb222-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># rule</span></span>
<span id="cb222-10"><a href="an-introduction-to-web-scraping-in-r.html#cb222-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Sys.sleep</span>(<span class="dv">5</span>)</span>
<span id="cb222-11"><a href="an-introduction-to-web-scraping-in-r.html#cb222-11" aria-hidden="true" tabindex="-1"></a>    school <span class="ot">&lt;-</span> jsonlite<span class="sc">::</span><span class="fu">read_json</span>(<span class="fu">paste0</span>(<span class="st">&quot;https://tuitiontracker.org/fitness/data/school-data/&quot;</span>,</span>
<span id="cb222-12"><a href="an-introduction-to-web-scraping-in-r.html#cb222-12" aria-hidden="true" tabindex="-1"></a>        schools<span class="sc">$</span>unitid[i], <span class="st">&quot;.json&quot;</span>))</span>
<span id="cb222-13"><a href="an-introduction-to-web-scraping-in-r.html#cb222-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># clean the flag scores and unlist</span></span>
<span id="cb222-14"><a href="an-introduction-to-web-scraping-in-r.html#cb222-14" aria-hidden="true" tabindex="-1"></a>    scores <span class="ot">&lt;-</span> school<span class="sc">$</span>flags <span class="sc">%&gt;%</span></span>
<span id="cb222-15"><a href="an-introduction-to-web-scraping-in-r.html#cb222-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">str_replace_all</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">[|</span><span class="sc">\\</span><span class="st">]&quot;</span>, <span class="st">&quot;&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb222-16"><a href="an-introduction-to-web-scraping-in-r.html#cb222-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">str_split</span>(<span class="st">&quot;,&quot;</span>) <span class="sc">%&gt;%</span>  <span class="fu">str_split</span>(<span class="st">&quot;,&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb222-17"><a href="an-introduction-to-web-scraping-in-r.html#cb222-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unlist</span>()</span>
<span id="cb222-18"><a href="an-introduction-to-web-scraping-in-r.html#cb222-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># save the stuff</span></span>
<span id="cb222-19"><a href="an-introduction-to-web-scraping-in-r.html#cb222-19" aria-hidden="true" tabindex="-1"></a>    dat<span class="sc">$</span>school[i] <span class="ot">&lt;-</span> school<span class="sc">$</span>institution</span>
<span id="cb222-20"><a href="an-introduction-to-web-scraping-in-r.html#cb222-20" aria-hidden="true" tabindex="-1"></a>    dat<span class="sc">$</span>unitid[i] <span class="ot">&lt;-</span> school<span class="sc">$</span>unitid</span>
<span id="cb222-21"><a href="an-introduction-to-web-scraping-in-r.html#cb222-21" aria-hidden="true" tabindex="-1"></a>    dat<span class="sc">$</span>enrollment_stress[i] <span class="ot">&lt;-</span> scores[<span class="dv">1</span>]</span>
<span id="cb222-22"><a href="an-introduction-to-web-scraping-in-r.html#cb222-22" aria-hidden="true" tabindex="-1"></a>    dat<span class="sc">$</span>retention_stress[i] <span class="ot">&lt;-</span> scores[<span class="dv">2</span>]</span>
<span id="cb222-23"><a href="an-introduction-to-web-scraping-in-r.html#cb222-23" aria-hidden="true" tabindex="-1"></a>    dat<span class="sc">$</span>avg_tui_stress[i] <span class="ot">&lt;-</span> scores[<span class="dv">3</span>]</span>
<span id="cb222-24"><a href="an-introduction-to-web-scraping-in-r.html#cb222-24" aria-hidden="true" tabindex="-1"></a>    dat<span class="sc">$</span>approp_stress[i] <span class="ot">&lt;-</span> scores[<span class="dv">4</span>]</span>
<span id="cb222-25"><a href="an-introduction-to-web-scraping-in-r.html#cb222-25" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## Warning in stri_split_regex(string, pattern, n = n, simplify = simplify, : argument is not an atomic
## vector; coercing

## Warning in stri_split_regex(string, pattern, n = n, simplify = simplify, : argument is not an atomic
## vector; coercing

## Warning in stri_split_regex(string, pattern, n = n, simplify = simplify, : argument is not an atomic
## vector; coercing</code></pre>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="an-introduction-to-web-scraping-in-r.html#cb224-1" aria-hidden="true" tabindex="-1"></a>dat</span></code></pre></div>
<pre><code>## # A tibble: 3 × 6
##   school                         unitid enrollment_stre… retention_stress avg_tui_stress approp_stress
##   &lt;chr&gt;                          &lt;chr&gt;  &lt;chr&gt;            &lt;chr&gt;            &lt;chr&gt;          &lt;chr&gt;        
## 1 University of California-Sant… 110705 &quot;c(\&quot;0\&quot;&quot;        &quot; \&quot;0\&quot;&quot;         &quot; \&quot;0\&quot;&quot;       &quot; \&quot;0\&quot;)&quot;    
## 2 California Polytechnic State … 110422 &quot;c(\&quot;0\&quot;&quot;        &quot; \&quot;0\&quot;&quot;         &quot; \&quot;0\&quot;&quot;       &quot; \&quot;0\&quot;)&quot;    
## 3 California State University-S… 110617 &quot;c(\&quot;0\&quot;&quot;        &quot; \&quot;0\&quot;&quot;         &quot; \&quot;3\&quot;&quot;       &quot; \&quot;0\&quot;)&quot;</code></pre>
<p>To recap, we performed the following steps:</p>
<ol style="list-style-type: decimal">
<li><p>Identified a website we wanted to scrape</p></li>
<li><p>Used the <code>polite</code> package to see if we were allowed to scrape the site</p></li>
<li><p>We used Google Chrome’s inspector function to look at the source code</p></li>
<li><p>We went to network and refreshed the page to try and find the source of the data</p></li>
<li><p>We guessed which file had the data. When we found it, we imported the data into <code>R</code> using the url.</p></li>
</ol>
</div>
<div id="web-scraping-ucsb-economics-contact-information" class="section level2" number="10.4">
<h2><span class="header-section-number">10.4</span> Web Scraping: UCSB Economics Contact Information</h2>
<p>Pulling from an API is always the preferable approach. However, sometimes we can’t pull from an API because it isn’t publicly available. In that case, we have to scrape the html directly from the website. Hadley Wickham, tidyverse creator, developed the <code>rvest</code> to assist in web scraping in R. There are many blog posts describing how to use <code>rvest,</code> but I’d recommend starting with the official <a href="https://github.com/tidyverse/rvest">github page</a>. This example will require using <code>SelectorGadget</code>.</p>
<p>In my experience, scraping a web page has a very similar code structure:</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="an-introduction-to-web-scraping-in-r.html#cb226-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read_html</span>(<span class="st">&quot;website_name&quot;</span>) <span class="sc">%&gt;%</span> <span class="co"># read in html</span></span>
<span id="cb226-2"><a href="an-introduction-to-web-scraping-in-r.html#cb226-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">&quot;found with selector gadget&quot;</span>) <span class="sc">%&gt;%</span> <span class="co">#find right node</span></span>
<span id="cb226-3"><a href="an-introduction-to-web-scraping-in-r.html#cb226-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text</span>() <span class="sc">%&gt;%</span> <span class="co"># convert to text</span></span>
<span id="cb226-4"><a href="an-introduction-to-web-scraping-in-r.html#cb226-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="co"># tidy it up</span></span></code></pre></div>
<p>The first line reads in the website, the second line tells R which part of the html code to find, the third line converts it into readable text, and the fourth line puts it in a tibble. Each line will be discussed in detail through the example.</p>
<p>We’re going to pull data from the <a href="https://econ.ucsb.edu/people">UCSB Economics Directory</a>.<a href="#fn16" class="footnote-ref" id="fnref16"><sup>16</sup></a> Our goal is to create a tibble with an individual’s name.</p>
<p>To start, let’s take a look at the website:</p>
<div class="figure">
<img src="web_scraping_tutorial/pictures/p8.png" style="width:100.0%" alt="" />
<p class="caption">UCSB Economics Directory Screenshot</p>
</div>
<p>First, let’s make sure we have permission to scrape this site:</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="an-introduction-to-web-scraping-in-r.html#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bow</span>(<span class="at">url=</span><span class="st">&quot;https://econ.ucsb.edu/people&quot;</span>,</span>
<span id="cb227-2"><a href="an-introduction-to-web-scraping-in-r.html#cb227-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb227-3"><a href="an-introduction-to-web-scraping-in-r.html#cb227-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">user_agent =</span> <span class="st">&quot;Danny Klinenberg &lt;dklinenberg@ucsb.edu&gt;&quot;</span>)</span></code></pre></div>
<pre><code>## &lt;polite session&gt; https://econ.ucsb.edu/people
##     User-agent: Danny Klinenberg &lt;dklinenberg@ucsb.edu&gt;
##     robots.txt: 42 rules are defined for 1 bots
##    Crawl delay: 5 sec
##   The path is scrapable for this user-agent</code></pre>
<p>Good news, we have permission! Now, we’re going to read in the raw html code into R:</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="an-introduction-to-web-scraping-in-r.html#cb229-1" aria-hidden="true" tabindex="-1"></a>website <span class="ot">&lt;-</span> <span class="fu">read_html</span>(<span class="st">&quot;https://econ.ucsb.edu/people&quot;</span>)</span></code></pre></div>
<p>Take a moment to open the website object in R. You should notice that it’s incomprehensible. It’s some list titled <code>&lt;html&gt;</code> then it has something called <code>&lt;body&gt;</code> and some other stuff. Thanks to Hadley, we don’t need to parse through the raw html code to try and extract our desired information. Instead, we can use the <code>rvest</code> package. Through rvest, we can tell <code>R</code> which specific node<a href="#fn17" class="footnote-ref" id="fnref17"><sup>17</sup></a> of the html code we want and it’ll grab the information for that node. To know which node we want, we use the selector gadget in chrome. To open selector gadget, click the puzzle piece in the top right hand corner, then the magnifying glass:</p>
<div class="figure">
<img src="web_scraping_tutorial/pictures/p9.png" style="width:100.0%" alt="" />
<p class="caption">Opening Selector Gadget</p>
</div>
<p>Once open, you’ll notice a bunch of random orange squares appearing when you move your mouse. If you click on/next to a specific element, the square will turn green. At the bottom of the screen, you’ll notice a string in a box:</p>
<div class="figure">
<img src="web_scraping_tutorial/pictures/p10.png" style="width:100.0%" alt="" />
<p class="caption">Selector Gadget after clicking next to Alexander Abajian</p>
</div>
<p>The green is the html node we asked for while the yellow boxes are the “guesses” selector gadget is making on information you want. If you click a yellow box (e.g. next to Camilo Abbate Granada’s name), the box will turn red and the string at the bottom (green circle) will change. If you click Camilo’s name again, it will turn yellow again. Once we have the information we want highlighted, we copy the string in the green circle and paste it into <code>html_nodes</code>:</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="an-introduction-to-web-scraping-in-r.html#cb230-1" aria-hidden="true" tabindex="-1"></a>website <span class="sc">%&gt;%</span></span>
<span id="cb230-2"><a href="an-introduction-to-web-scraping-in-r.html#cb230-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_nodes</span>(<span class="st">&quot;h3&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb230-3"><a href="an-introduction-to-web-scraping-in-r.html#cb230-3" aria-hidden="true" tabindex="-1"></a>    .[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]  <span class="co"># only displaying first 5</span></span></code></pre></div>
<pre><code>## {xml_nodeset (5)}
## [1] &lt;h3&gt;&lt;a href=&quot;/people/students/alexander-abajian&quot; hreflang=&quot;en&quot;&gt;Alexander Abajian&lt;/a&gt;&lt;/h3&gt;
## [2] &lt;h3&gt;&lt;a href=&quot;/people/students/camilo-abbate-granada&quot; hreflang=&quot;en&quot;&gt;Camilo Abbate Granada&lt;/a&gt;&lt;/h3&gt;
## [3] &lt;h3&gt;&lt;a href=&quot;/people/students/hazem-alshaikhmubarak&quot; hreflang=&quot;en&quot;&gt;Hazem Alshaikhmubarak&lt;/a&gt;&lt;/h3&gt;
## [4] &lt;h3&gt;&lt;a href=&quot;/people/students/roberto-amaral-de-castro-prado-santos&quot; hreflang=&quot;en&quot;&gt;Roberto Amar ...
## [5] &lt;h3&gt;&lt;a href=&quot;/people/lecturers/bob-anderson&quot; hreflang=&quot;en&quot;&gt;Bob Anderson&lt;/a&gt;&lt;/h3&gt;</code></pre>
<p>We could parse the information we want ourselves, or we could use the <code>html_text</code> command:</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="an-introduction-to-web-scraping-in-r.html#cb232-1" aria-hidden="true" tabindex="-1"></a>website <span class="sc">%&gt;%</span> </span>
<span id="cb232-2"><a href="an-introduction-to-web-scraping-in-r.html#cb232-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">&quot;h3&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb232-3"><a href="an-introduction-to-web-scraping-in-r.html#cb232-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text</span>(<span class="at">trim=</span>T) <span class="sc">%&gt;%</span> <span class="co"># removes hanging white space at the beginning and end</span></span>
<span id="cb232-4"><a href="an-introduction-to-web-scraping-in-r.html#cb232-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb232-5"><a href="an-introduction-to-web-scraping-in-r.html#cb232-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) <span class="co"># only displaying first 5</span></span></code></pre></div>
<pre><code>## # A tibble: 5 × 1
##   value                                
##   &lt;chr&gt;                                
## 1 Alexander Abajian                    
## 2 Camilo Abbate Granada                
## 3 Hazem Alshaikhmubarak                
## 4 Roberto Amaral de Castro Prado Santos
## 5 Bob Anderson</code></pre>
<p>To extend this, you can add html endpoints to <code>html_nodes</code> using inspector gadget. Then it’s a matter of parsing the data using our data wrangling tools!</p>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="12">
<li id="fn12"><p>The whole package is inspired by British etiquette at a tea party. They really get into it on their <a href="https://www.rostrum.blog/2019/03/04/polite-webscrape/">blogpost</a>.<a href="an-introduction-to-web-scraping-in-r.html#fnref12" class="footnote-back">↩︎</a></p></li>
<li id="fn13"><p>I’m not sure how to access the rules and it hasn’t come up as an issue yet so hopefully it’s fine?<a href="an-introduction-to-web-scraping-in-r.html#fnref13" class="footnote-back">↩︎</a></p></li>
<li id="fn14"><p>For those extra excited, we’ll be using <code>Sys.Sleep</code> at the beginning of each loop.<a href="an-introduction-to-web-scraping-in-r.html#fnref14" class="footnote-back">↩︎</a></p></li>
<li id="fn15"><p>You’ll have to work with <code>.ndjson</code> files if you want to use the Parler data dump.<a href="an-introduction-to-web-scraping-in-r.html#fnref15" class="footnote-back">↩︎</a></p></li>
<li id="fn16"><p>If the UCSB page has undergone major revisions, you can replace the url with an archived verison of the page: <a href="https://web.archive.org/web/20210722193128/https://econ.ucsb.edu/people" class="uri">https://web.archive.org/web/20210722193128/https://econ.ucsb.edu/people</a><a href="an-introduction-to-web-scraping-in-r.html#fnref16" class="footnote-back">↩︎</a></p></li>
<li id="fn17"><p>html lingo for element.<a href="an-introduction-to-web-scraping-in-r.html#fnref17" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="strings.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="programming.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/jules32/bookdown-tutorial/edit/master/web_scraping_tutorial/web_scrape_lecture.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["series.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
